<div class="row">
    <div class="bs-component">
        <div class="panel" id="tab_panel">
            <div class="panel-heading">
                <ul class="nav panel-tabs-border panel-tabs panel-tabs-left">
                    <li class="" style="display:none;"><a href="#project" data-toggle="tab"><span class="fa fa-cubes"></span>项目管理</a></li>
                </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content pn br-n">
                    <div id="project" class="tab-pane pn " tabindex="1" style="display:none;">
                        <!--cnd start-->
                        <div class="row">
                            <div class="panel panel-visible" id="cnd">
                                <!-- Condition panel -->
                                <div class="panel-body">
                                    <div class="form-horizontal admin-form weui-form">
                                        <div class="row">
                                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                                <label for="cnd_name" class="col-lg-4 col-md-4 col-sm-6 control-label">项目名称：</label>
                                                <div class="col-lg-8 col-md-8 col-sm-6">
                                                    <label class="field prepend-icon">
                                                        <input type="text" data-id="cnd_name" id="cnd_name" name="cnd_name" class="form-control cnd-Name">
                                                        <label class="field-icon"><i class="fa fa-cubes"></i></label>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                                <label for="cnd_name" class="col-lg-4 col-md-4 col-sm-6 control-label">类型：</label>
                                                <div class="col-lg-8 col-md-8 col-sm-6">
                                                    <label class="field prepend-icon">
                                                        <select type="text" data-id="cnd_type" name="cnd_name" class="form-control cnd-Name">
                                                            <option value="">请选择</option>
                                                            <option value="1">渠道</option>
                                                            <option value="2">个案</option>
                                                        </select>
                                                        <label class="field-icon"><i class="fa fa-cubes"></i></label>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                                <label for="cnd_begindate" class="col-lg-4 col-md-4 col-sm-6 control-label">开始日期：</label>
                                                <div class="col-lg-8 col-md-8 col-sm-6">
                                                    <label class="field prepend-icon">
                                                        <input type="text" data-id="cnd_beginDate" id="cnd_beginDate" name="cnd_begindate" class="form-control cnd-begindate weui-datepicker weui-datebegin">
                                                        <label class="field-icon"><i class="fa fa-calendar"></i></label>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                                <label for="cnd_enddate" class="col-lg-4 col-md-4 col-sm-6 control-label">结束日期：</label>
                                                <div class="col-lg-8 col-md-8 col-sm-6">
                                                    <label class="field prepend-icon">
                                                        <input type="text" data-id="cnd_endDate" id="cnd_endDate" name="cnd_enddate" class="form-control cnd-enddate weui-datepicker weui-dateend">
                                                        <label class="field-icon"><i class="fa fa-calendar"></i></label>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Control panel -->
                                <div class="row panel-footer action-container">
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                        <label class="col-lg-4 col-md-4 col-sm-6 control-label"></label>
                                        <div class="col-lg-8 col-md-8 col-sm-6">
                                            <!--<button type="submit" class="btn btn-default btn-block">提交</button>-->
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                        <label class="col-lg-4 col-md-4 col-sm-6 control-label"></label>
                                        <div class="col-lg-8 col-md-8 col-sm-6">
                                            <button type="button" class="btn btn-primary btn-sm pull-right action-query"><i class="fa fa-search"></i>查询</button>
                                            <!-- <button type="button" class="btn btn-default btn-sm pull-right create-account">添加项目</button> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--cnd end-->
                        <div class="row">
                            <div class="panel panel-visible" id="dat">
                                <div class="panel-body pn">
                                    <table class="table table-striped table-hover" id="datatable_project">
                                        <thead>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Project Modal -->
<div class="modal fade" id="project_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"><span class="fa fa-edit"></span><span class="caption"></span></h4>
            </div>
            <div class="form-horizontal admin-form">
                <form id="project_form" method="post" class="weui-form">
                    <div class="modal-body">
                        <div class="row">
                            <!--<input type="hidden" id="col_subsys" class="gui-input" value="wenjuan">-->
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_name" class="col-lg-4 col-md-4 col-sm-6 control-label">项目：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <input type="text" name="project_name" id="project_name"  class="form-control col_name gui-input project_name" weuifieldname="name" maxlength="50" weuifieldclass="col_name"  weuiremotemessage="用户已存在" required>
                                        <label class="field-icon"><i class="fa fa-cubes"></i></label>
                                    </label>
                                    <span for="type" class="project-error" style="display:none;color:#DE888A;margin-top:6px;display:block;">项目名称重复请重新输入</span>
                                </div>
                            </div>
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_type" class="col-lg-4 col-md-4 col-sm-6 control-label">类型：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <select type="text" name="type" class="form-control col_type gui-input"  weuifieldcode="typeCode" weuifieldname="typeName" weuifieldclass="type" required>
                                            <option value="xyz" disabled="disabled">请选择</option>
                                            <option value="1">渠道</option>
                                            <option value="2">个案</option>
                                        </select>
                                        <label class="field-icon"><i class="fa fa-check-square-o"></i></label>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_begindate" class="col-lg-4 col-md-4 col-sm-6 control-label ">开始日期：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <input type="text" name="beginDate" class="form-control col_begindate gui-input weui-datepicker weui-datebegin" weuifieldname="beginDate" weuifieldclass="col_begin" required>
                                        <label class="field-icon"><i class="fa fa-calendar"></i></label>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_endDate" class="col-lg-4 col-md-4 col-sm-6 control-label ">结束日期：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <input type="text" name="endDate" class="form-control col_enddate gui-input weui-datepicker weui-dateend" weuifieldname="endDate" weuifieldclass="col_end" required>
                                        <label class="field-icon"><i class="fa fa-calendar"></i></label>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_director" class="col-lg-4 col-md-4 col-sm-6 control-label">项目经理：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <input type="text" name="director" class="form-control col_director gui-input" weuifieldname="director" weuifieldclass="col_director"  required>
                                        <label class="field-icon"><i class="fa fa-male"></i></label>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">

                            </div>
                        </div>
                        <div class="row">
                            <!--<div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_mebers" class="col-lg-4 col-md-4 col-sm-6 control-label">项目成员：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <textarea type="text" rows="6" name="mebers" class="form-control col_mebers gui-input" weuifieldname="mebers" weuifieldclass="col_members"  required>
                                        <label class="field-icon"><i class="fa fa-group"></i></label>
                                    </label>
                                </div>
                            </div>-->
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_mebers" class="col-lg-4 col-md-4 col-sm-6 control-label">项目成员：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <textarea type="text" rows="6" name="mebers" class="form-control col_mebers gui-input pt5" weuifieldname="mebers" weuifieldclass="col_members" />
                                        <label class="field-icon"><i class="fa fa-edit"></i></label>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                <label for="col_remark" class="col-lg-4 col-md-4 col-sm-6 control-label">备注：</label>
                                <div class="col-lg-8 col-md-8 col-sm-6">
                                    <label class="field prepend-icon">
                                        <textarea type="text" rows="6" name="remark" class="form-control col_remark gui-input pt5" weuifieldname="remark" weuifieldclass="col_remark" />
                                        <label class="field-icon"><i class="fa fa-edit"></i></label>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-sm cancel" data-dismiss="modal"><i class="fa fa-close"></i>关闭</button>
                        <button type="submit" class="btn btn-primary btn-sm accept submit"><i class="fa fa-save"></i><span class="caption"></span></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function() {
        //datepick
        var theManageTable = null,
            theManageColumns = null,
            theProjectCount = 0,
            theProjectDummy = true,
            theManageOption = null;
        Core.runWeUIElements();
        //
        var theProjectTable = $('#datatable_project');

        var theProjectColumns = [{
            "aTargets": [0],
            "mData": "id",
            "sTitle": "#",
            "sWidth": "12px",
            "bSortable": false,
            "mRender": function(data, type, full) {
                return "<input type='checkbox' name='selector' checked='checked' style='margin-left:8px;' />";
            }
        }, {
            "aTargets": [1],
            "mData": "name",
            "sTitle": "项目",
            "sClass": "text-align-left",
            "sWidth": "128px",
            "mRender": null
        }, {
            "aTargets": [2],
            "mData": "typeCode",
            "sTitle": "类型",
            "sWidth": "42px",
            "mRender": function(data, type, full) {
                return "<span>" + (full.typeCode == 1 ? "渠道" : "个案") + "</span>";
            }
        }, {
            "aTargets": [3],
            "mData": "beginDate",
            "sTitle": "开始日期",
            "sWidth": "72px",
            "mRender": null
        }, {
            "aTargets": [4],
            "mData": "endDate",
            "sTitle": "结束日期",
            "sWidth": "72px",
            "mRender": null
        }, {
            "aTargets": [5],
            "mData": "director",
            "sTitle": "项目经理",
            "sClass": "text-align-left",
            "sWidth": "58px",
            "mRender": null
        }, {
            "aTargets": [6],
            "mData": "mebers",
            "sTitle": "项目成员",
            "sClass": "text-align-left",
            "sWidth": "150px",
            "mRender": null
        }, {
            "aTargets": [7],
            "mData": "quotaServiceState",
            "sTitle": "配额服务状态",
            "sWidth": "68px",
            "mRender": function(data, type, full) {
                if (full.quotaServiceState == 1) {
                    return '<span  style="color:#ccc">暂停</span>'
                }
                if (full.quotaServiceState == 2) {
                    return '<span style="color:#4CAE4C">启用</span>'
                }
            }
        }, {
            "aTargets": [8],
            "mData": "quotaServiceState",
            "sTitle": "配额服务操作",
            "sWidth": "68px",
            "mRender": function(data, type, full) {
                var quotaServiceName = "";
                if (full.quotaServiceState == 1) {
                    quotaServiceName = "启用";
                }
                if (full.quotaServiceState == 2) {
                    quotaServiceName = "暂停";
                }
                return '<span class="inline-action-container">' +
                    '<a href="#"><span class="fa fa-gear"></span><span class="action-quotaState">' + quotaServiceName + '</span></a>' +
                    '</span>';
            }
        }, {
            "aTargets": [9],
            "mData": "state",
            "sTitle": "项目状态",
            "sWidth": "68px",
            "mRender": function(data, type, full) {
                if (full.state == 0) {
                    return '<span class="action-projectState" style="color:#4CAE4C">初始化</span>'
                }
                if (full.state == 1) {
                    return '<span class="action-projectState" style="color:#4CAE4C">启用</span>'
                }
                if (full.state == 2) {
                    return '<span class="action-projectState" style="color:#ccc">冻结</span>'
                }
            }
        }, {
            "aTargets": [10],
            "mData": "remark",
            "sTitle": "备注",
            "sClass": "text-align-left",
            //"sWidth": "150px",
            "mRender": null
        }, {
            "aTargets": [11],
            "mData": "id",
            "sTitle": "操作",
            "sWidth": "395px",
            "bSortable": false,
            "mRender": function(data, type, full) {
                var stateName = "";
                if (full.state == 0 || full.state == 2) {
                    stateName = "启用"
                } else if (full.state == 1) {
                    stateName = "冻结"
                }
                return '<span class="inline-action-container">' +
                    '<a href="#"><span class="fa fa-edit fa-default"></span><span class="action-update">编辑</span></a><span class="text-divider">|</span> ' +
                    '<a href="#"><span class="fa fa-check fa-success"></span><span class="action-state">' + stateName + '</span></a><span class="text-divider">|</span> ' +
                    '<a href="#"><span class="fa fa-exclamation-triangle fa-danger"></span><span class="action-delete">删除</span></a> ' +
                    '</span>';
            }
        }];
        //子系统标示

        theProjectOption = {
            aButtons: [{
                "sButtonText": "csv",
                "sExtends": "xls",
            }, "add"],
            preDrawCallback: function() {
                return theProjectDummy;
            },
            rowCallback: function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $(nRow).data(aData);
            },
            onCreate: function() {
                testing();
                var modal = new Modal($("#project_modal"), null, null, function(projectdata) {
                    var rowData = projectdata;
                    projectdata.quotaServiceState = 1;
                    projectdata.type = 1;
                    $('textarea').val('');
                    var url = myapp.apiHost2 + "wesurvey.addproject.do?operateState=1";
                    AjaxGet2(url, "json", "post", projectdata, function(data) {
                        theProjectTable.dataTable().fnDraw();
                    }, function(error) {

                    });

                }, {
                    Entity: "项目"
                });
                modal.show();
            },
            onUpdate: function(data, tr) {
                var modal = new Modal($("#project_modal"), data, tr, function(projectdata) {
                    $('#project_name').focus();
                    var url = myapp.apiHost2 + "wesurvey.addproject.do?operateState=2";
                    AjaxGet2(url, "json", "post", projectdata, function(data) {
                        theProjectTable.dataTable().fnDraw();
                    }, function(error) {

                    });
                }, {
                    Entity: "项目"
                });
                modal.show();
            },
            onDelete: function(data, tr) {
                var url = myapp.apiHost2 + "wesurvey.addproject.do?operateState=3&id=" + data.id;
                new MessageModal($("#message-modal"), "确定要删除选中的项目吗？", tr, function(tmpdata) {
                    AjaxGet2(url, "json", "post", null, function(data) {
                        Core.deleteRow(theProjectTable, tr);
                    }, function(error) {
                        alert(error)
                    })

                }).error();
            },
            processing: true,
            serverSide: true,
            scrollX: true,
            ajaxSource: myapp.apiHost2 + "sysmng.jsonreport.do",
            ajaxDataProp: "objs",
            basicDataCallback: function(aoData) {
                basicData(aoData, 1, theProjectCount, "#project");
            },
            setCountCallback: function(count) {
                theProjectCount = count;
            }
        };
        // 查询
        $("#project .action-query").unbind("click").bind("click", function() {
            theProjectDummy = true;
            theProjectTable.dataTable().fnDraw();
        });

        $("#datatable_project").unbind('click').bind('click', function(e) {
            var cur = $(e.target);
            var tr = $(e.target).parents("tr");
            var auditData = tr.data();
            if (cur.hasClass('action-quotaState')) {
                new MessageModal($("#message-modal"), "确定要更改当前状态？", null, function(data) {
                    AjaxPost2(myapp.apiHost2 + "wesurvey.quotaServer.do?op=serviceState&projectID=" + auditData.id + "&quotaServiceState=" + auditData.quotaServiceState, [], null, function(data) {
                            theProjectTable.dataTable().fnDraw();
                        },
                        function(error) {
                            console.log(error);
                        });
                }).error();
            } else if (cur.hasClass('action-state')) {
                AjaxPost2(myapp.apiHost2 + "wesurvey.addproject.do?op=setState&projectID=" + auditData.id, auditData, null, function(data) {
                        theProjectTable.dataTable().fnDraw();
                    },
                    function(error) {
                        console.log(error);
                    });
            }
        });

        //验证用户名是否重复
        $('.project-error').hide();

        function testing() {
            $('#project_name').blur(function() {
                $('.project-error').hide();
                if ($('#project_name').val() != '') {
                    var _this = $(this)
                    var projectName = _this.val();
                    var data = linkApiData(124);
                    data.cnd_projectName = projectName;
                    data.selCndIDs = "projectName";
                    AjaxPost2(myapp.apiHost2 + "sysmng.jsonreport.do", data, null, function(data) {
                        if (data.objs[0].name > 0) {
                            _this.addClass('input-error');
                            $('.accept').attr('disabled', 'disabled');
                            $('.project-error').show();
                        }
                    }, function(error) {
                        console.log(error);
                    });
                };
            }).focus(function() {
                $(this).removeClass('input-error');
                $('.project-error').hide();
                $('.accept').removeAttr('disabled');

            });
        }

        $(function() {
            Core.runWeUIElements();
            //
            var activateTabPage = function(index) {
                var tr = '<tr class="odd"><td valign="top" colspan="6" class="dataTables_empty">没有匹配结果</td> </tr>';
                var container = $('.tab-pane[tabindex=' + index + ']');
                if (index == 1) {
                    $('table tbody', container).html(tr);
                    Core.initDataTable(theProjectTable, theProjectColumns, theProjectOption);
                }
            };

            initTabs(activateTabPage);

        })
    });
    //# sourceURL=dynamicScript-system-project.js
</script>